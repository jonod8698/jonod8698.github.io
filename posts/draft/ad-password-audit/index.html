<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AD Password Audit | Jdsec</title>
<meta name=keywords content="AD,Identity"><meta name=description content="Ad Password Audit"><meta name=author content="JD"><link rel=canonical href=https://technologify.net/posts/draft/ad-password-audit/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://technologify.net/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://technologify.net/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://technologify.net/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://technologify.net/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://technologify.net/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://technologify.net/posts/draft/ad-password-audit/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://technologify.net/posts/draft/ad-password-audit/"><meta property="og:site_name" content="Jdsec"><meta property="og:title" content="AD Password Audit"><meta property="og:description" content="Ad Password Audit"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-21T21:48:57+11:00"><meta property="article:modified_time" content="2022-01-21T21:48:57+11:00"><meta property="article:tag" content="AD"><meta property="article:tag" content="Identity"><meta property="og:image" content="https://technologify.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://technologify.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="AD Password Audit"><meta name=twitter:description content="Ad Password Audit"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://technologify.net/posts/"},{"@type":"ListItem","position":2,"name":"AD Password Audit","item":"https://technologify.net/posts/draft/ad-password-audit/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AD Password Audit","name":"AD Password Audit","description":"Ad Password Audit","keywords":["AD","Identity"],"articleBody":"Problem Statement Accounts with bad passwords, especially accounts with privileged access are the Achilles heel of an organisation’s security. Traditionally IT has tried to impose “strong password policies” such as “Choose a password with an uppercase letter, a number, a symbol and more than 10 characters”. However, a password like “Summer2020!” satisfies ALL those requirements despite being an immesurably weak password.\nSo, what can we as IT professionals do to reduce bad passwords and mitigate their impact?\nMFA if possible. Yes, it’s been repeated to the ground but only 57% percent of organisations use MFA. Restrict work account access to managed devices. Disable Legacy authentication. Block or limit access to public facing web portals such as OWA, VPN portals and RDweb. Impose rate limiting and lockout periods for incorrect authentication attempts. Dectect password spraying across multiple accounts by creating honey accounts with login hours set to nothing and set your SIEM to alert when a login attempt is made for that account. Audit passwords regularly – I’ll go into more depth later about one way to approach this. Encourage users to use passphrases. Yes, I do know that passphrases are weak against dictionary attacks, but much like online games, effective strategies change with the “meta” – the current state of the game. At the moment, as most organisations have password policies which encourage 8 character passwords with special characters and numbers, that’s what attackers are expecting. Reduce the ways attacks can obtain NTLMv2 hashes for offline cracking. I.e. disable LLNMR and NBT-NS, block port 445 egress, don’t use domain admin accounts to login to user workstations, enable windows credential guard, minimise use of office macros. Password managers – addresses credential reuse and allows for password auditing. I will revisit password managers in another article. Implement Password Policies through technical controls and company policies. Lithnet Password Protection and Azure AD Password Protection are both great solutions. How to Remediate: Password Auditing One very effective way of assessing the current state of passwords in your organisation is to dump the ntds.dit file and run it against common password lists and masks. Note: depending on your org, this may not be allowed as dumping the ntds.dit file containing all user hashes is risky as if an attacker accesses it, they can guess passwords offline.\nOn a domain controller with an elevated Command Prompt run: ntdsutil \"ac in ntds\" \"ifm\" \"cr fu c:temp\" q q Files will be located in C:\\Windows\\System32\\temp\nCopy the ntds.dit file to another computer with hashcat installed.\nExtract the NTLMv2 hashes from the ntds.dat file.\nimpacket-secretsdump -system registry/SYSTEM -ntds \"Active Directory/ntds.dit\" LOCAL -outputfile hashes.txt #another option python3 /opt/impacket/examples/secretsdump.py -system registry/SYSTEM -ntds \"Active Directory/ntds.dit\" LOCAL -outputfile hashes.txt Run hashcat against the hashes.txt file. I had the most success with the “dive.rule” combined with rockyou sudo gzip -d /usr/share/wordlists/rockyou.txt.gz hashcat -m 1000 -a 0 -o cracked.txt hashes.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/dive.rule –force Windows\n.\\hashcat.exe -m 1000 -a 0 -o .\\cracked.txt .\\hashes.txt .\\rockyou.txt -r .\\dive.rule -O At the end you can use this awesome tool: Domain Password Audit Tool (DPAT) created by Carrie Roberts to summarise the results in a neat HTML report. python3 ./dpat.py -n hashes.txt -c hashcat.potfile -o report.html Using a Kali VM on my laptop I managed to crack 50% of our organisation’s passwords! You wouldn’t believe how many people had passwords like and . It was definitely a worthwhile exercise and was an eye-opener for management.\n","wordCount":"568","inLanguage":"en","image":"https://technologify.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2022-01-21T21:48:57+11:00","dateModified":"2022-01-21T21:48:57+11:00","author":{"@type":"Person","name":"JD"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://technologify.net/posts/draft/ad-password-audit/"},"publisher":{"@type":"Organization","name":"Jdsec","logo":{"@type":"ImageObject","url":"https://technologify.net/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://technologify.net/ accesskey=h title="Home (Alt + H)"><img src=https://technologify.net/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://technologify.net/categories/ title=categories><span>categories</span></a></li><li><a href=https://technologify.net/tags/ title=tags><span>tags</span></a></li><li><a href=https://technologify.net/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://technologify.net/>Home</a>&nbsp;»&nbsp;<a href=https://technologify.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">AD Password Audit</h1><div class=post-description>Ad Password Audit</div><div class=post-meta><span title='2022-01-21 21:48:57 +1100 +1100'>21 January, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;568 words&nbsp;·&nbsp;JD</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#problem-statement aria-label="Problem Statement">Problem Statement</a></li><li><a href=#how-to-remediate-password-auditing aria-label="How to Remediate: Password Auditing">How to Remediate: Password Auditing</a></li></ul></div></details></div><div class=post-content><h2 id=problem-statement>Problem Statement<a hidden class=anchor aria-hidden=true href=#problem-statement>#</a></h2><p>Accounts with bad passwords, especially accounts with privileged access are the Achilles heel of an organisation’s security. Traditionally IT has tried to impose “strong password policies” such as “Choose a password with an uppercase letter, a number, a symbol and more than 10 characters”. However, a password like “Summer2020!” satisfies ALL those requirements despite being an immesurably weak password.</p><p>So, what can we as IT professionals do to reduce bad passwords and mitigate their impact?</p><ul><li>MFA if possible. Yes, it’s been repeated to the ground but only <a href="https://www.bleepingcomputer.com/news/security/57-percent-of-businesses-use-multi-factor-auth-mfa-says-lastpass/?swcfpc=1#:~:text=Approximately%2057%25%20of%20businesses%20around,on%20data%20from%2047%2C000%20orgs.">57% percent of organisations use MFA</a>.</li><li>Restrict work account access to managed devices.</li><li>Disable Legacy authentication.</li><li>Block or limit access to public facing web portals such as OWA, VPN portals and RDweb.</li><li>Impose rate limiting and lockout periods for incorrect authentication attempts.</li><li>Dectect password spraying across multiple accounts by creating honey accounts with login hours set to nothing and set your SIEM to alert when a login attempt is made for that account.</li><li>Audit passwords regularly – I’ll go into more depth later about one way to approach this.</li><li>Encourage users to use passphrases. Yes, I do know that passphrases are weak against dictionary attacks, but much like online games, effective strategies change with the “meta” – the current state of the game. At the moment, as most organisations have password policies which encourage 8 character passwords with special characters and numbers, that’s what attackers are expecting.</li><li>Reduce the ways attacks can obtain NTLMv2 hashes for offline cracking. I.e. disable LLNMR and NBT-NS, block port 445 egress, don’t use domain admin accounts to login to user workstations, enable windows credential guard, minimise use of office macros.</li><li>Password managers – addresses credential reuse and allows for password auditing. I will revisit password managers in another article.</li><li>Implement Password Policies through technical controls and company policies. <a href=https://github.com/lithnet/ad-password-protection>Lithnet Password Protection</a> and <a href=https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad-on-premises>Azure AD Password Protection</a> are both great solutions.</li></ul><h2 id=how-to-remediate-password-auditing>How to Remediate: Password Auditing<a hidden class=anchor aria-hidden=true href=#how-to-remediate-password-auditing>#</a></h2><p>One very effective way of assessing the current state of passwords in your organisation is to dump the ntds.dit file and run it against common password lists and masks. Note: depending on your org, this may not be allowed as dumping the ntds.dit file containing all user hashes is risky as if an attacker accesses it, they can guess passwords offline.</p><ol><li>On a domain controller with an elevated Command Prompt run:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>ntdsutil <span class=s2>&#34;ac in ntds&#34;</span> <span class=s2>&#34;ifm&#34;</span> <span class=s2>&#34;cr fu c:temp&#34;</span> q q
</span></span></code></pre></div><p>Files will be located in C:\Windows\System32\temp</p><ol start=2><li><p>Copy the ntds.dit file to another computer with hashcat installed.</p></li><li><p>Extract the NTLMv2 hashes from the ntds.dat file.</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>impacket-secretsdump -system registry/SYSTEM -ntds <span class=s2>&#34;Active Directory/ntds.dit&#34;</span> LOCAL -outputfile hashes.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#another option</span>
</span></span><span class=line><span class=cl>python3 /opt/impacket/examples/secretsdump.py -system registry/SYSTEM -ntds <span class=s2>&#34;Active Directory/ntds.dit&#34;</span> LOCAL -outputfile hashes.txt
</span></span></code></pre></div><ol start=4><li>Run hashcat against the hashes.txt file. I had the most success with the “dive.rule” combined with rockyou</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo gzip -d /usr/share/wordlists/rockyou.txt.gz
</span></span><span class=line><span class=cl>hashcat -m <span class=m>1000</span> -a <span class=m>0</span> -o cracked.txt hashes.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/dive.rule –force
</span></span></code></pre></div><p>Windows</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>hashcat</span><span class=p>.</span><span class=py>exe</span> <span class=n>-m</span> <span class=mf>1000</span> <span class=n>-a</span> <span class=mf>0</span> <span class=n>-o</span> <span class=p>.\</span><span class=n>cracked</span><span class=p>.</span><span class=py>txt</span> <span class=p>.\</span><span class=n>hashes</span><span class=p>.</span><span class=py>txt</span> <span class=p>.\</span><span class=n>rockyou</span><span class=p>.</span><span class=py>txt</span> <span class=n>-r</span> <span class=p>.\</span><span class=n>dive</span><span class=p>.</span><span class=py>rule</span> <span class=n>-O</span>
</span></span></code></pre></div><ol start=5><li>At the end you can use this awesome tool: <a href=https://github.com/clr2of8/DPAT>Domain Password Audit Tool (DPAT)</a> created by Carrie Roberts to summarise the results in a neat HTML report.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 ./dpat.py -n hashes.txt -c hashcat.potfile -o report.html
</span></span></code></pre></div><p>Using a Kali VM on my laptop I managed to crack 50% of our organisation’s passwords! You wouldn’t believe how many people had passwords like <code>&lt;Season>&lt;Year></code> and <code>&lt;company name>&lt;number></code>. It was definitely a worthwhile exercise and was an eye-opener for management.</p><p><img alt="AD Passwords" loading=lazy src=/ad-password-audit-DPAT.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://technologify.net/tags/ad/>AD</a></li><li><a href=https://technologify.net/tags/identity/>Identity</a></li></ul><nav class=paginav><a class=prev href=https://technologify.net/posts/draft/stormspotter/><span class=title>« Prev</span><br><span>Stormspotter</span>
</a><a class=next href=https://technologify.net/posts/security/tpot/><span class=title>Next »</span><br><span>Creating a Honeypot with T-Pot</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://technologify.net/>Jdsec</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>